// Metawidget 3.8 minified
//
// This file is dual licensed under both the LGPL
// (http://www.gnu.org/licenses/lgpl-2.1.html) and the EPL
// (http://www.eclipse.org/org/documents/epl-v10.php). As a
// recipient of Metawidget, you may choose to receive it under either
// the LGPL or the EPL.
//
// Commercial licenses are also available. See http://metawidget.org
// for details.
//
// Author: Richard Kennard (http://kennardconsulting.com)

var metawidget=metawidget||{};(function(){var b=["$compile","$parse",function(d,e){return{restrict:"E",scope:{ngModel:"=",readOnly:"=",config:"=",ngShow:"=",ngHide:"=",configs:"&"},transclude:true,compile:function(h,g,f){return function(s,l,q){var r=new metawidget.angular.AngularMetawidget(l,q,f,s,d,e);var k;n();var i=s.$watch("ngModel",function(t){if(t!==k&&typeof(t)==="object"){r.invalidateInspection();n()}});var j=s.$watch("readOnly",function(t){if(t!==r.readOnly){n()}});var p=s.$watch("config",function(u,t){if(u!==t){r.configure(u);n()}});var o=s.$watch("ngShow",function(u,t){if(u!==t){n()}});var m=s.$watch("ngHide",function(u,t){if(u!==t){n()}});l.on("$destroy",function(){i();j();p();o();m()});function n(){if(s.$eval("ngShow")===false||s.$eval("ngHide")===true){return}k=s.$eval("ngModel");r.path=q.ngModel;r.toInspect=s.$parent.$eval(metawidget.util.splitPath(r.path).type);r.readOnly=s.$eval("readOnly");r.buildWidgets()}}}}}];var a=angular.module("metawidget",[]);a.directive("metawidget",b);a.directive("mwMetawidget",b);metawidget.angular=metawidget.angular||{};var c=0;metawidget.angular.AngularMetawidget=function(h,e,d,i,g,j){if(!(this instanceof metawidget.angular.AngularMetawidget)){throw new Error("Constructor called as a function")}var f=new metawidget.Pipeline(h[0]);f._superLayoutWidget=f.layoutWidget;f.layoutWidget=function(o,l,n,m,p){f._superLayoutWidget.call(this,o,l,n,m,p);if(o.overridden===undefined){g(o)(i.$parent)}};var k;this.invalidateInspection=function(){k=undefined};f.inspector=new metawidget.inspector.PropertyTypeInspector();f.inspectionResultProcessors=[new metawidget.angular.inspectionresultprocessor.AngularInspectionResultProcessor(i.$parent)];f.widgetBuilder=new metawidget.widgetbuilder.CompositeWidgetBuilder([new metawidget.widgetbuilder.OverriddenWidgetBuilder(),new metawidget.widgetbuilder.ReadOnlyWidgetBuilder(),new metawidget.widgetbuilder.HtmlWidgetBuilder()]);f.widgetProcessors=[new metawidget.widgetprocessor.IdProcessor(),new metawidget.widgetprocessor.PlaceholderAttributeProcessor(),new metawidget.widgetprocessor.DisabledAttributeProcessor(),new metawidget.angular.widgetprocessor.AngularWidgetProcessor(j,i.$parent)];
f.layout=new metawidget.layout.HeadingTagLayoutDecorator(new metawidget.layout.TableLayout());this.configure=function(l){f.configure(l);this.invalidateInspection()};this.configure(i.$eval("config"));this.configure(i.configs());this.inspect=function(n,l,m){return f.inspect(n,l,m,this)};this.buildWidgets=function(p){var l=d(i.$parent,function(q){return q});this.overriddenNodes=[];for(var m=0;m<l.length;m++){var o=l[m];if(o.nodeType===1&&(o.tagName!=="SPAN"||o.attributes.length>1)){this.overriddenNodes.push(o)}}if(p!==undefined){k=p}else{if(k===undefined){if(arguments.length>0){throw new Error("Calling buildWidgets( undefined ) may cause infinite loop. Check your argument, or pass no arguments instead")}var n=metawidget.util.splitPath(this.path);k=f.inspect(this.toInspect,n.type,n.names,this)}}h.children().remove();f.buildWidgets(k,this)};this.onEndBuild=function(){while(this.overriddenNodes.length>0){var m=this.overriddenNodes[0];this.overriddenNodes.splice(0,1);if(m.tagName==="FACET"){continue}var p;var r,n;n=m.attributes.length;for(r=0;r<n;r++){var o=m.attributes[r];var q=e.$normalize(o.name).toLowerCase();if(q==="ngbind"||q==="ngmodel"){var s=metawidget.util.splitPath(o.value);var t=i.$parent.$eval(s.type);p=f.inspect(t,s.type,s.names,this);break}}if(p===undefined){p={section:""}}if(m.tagName==="STUB"){n=m.attributes.length;for(r=0;r<n;r++){var l=m.attributes[r];p[l.nodeName]=l.nodeValue}}f.layoutWidget(m,"property",p,f.element,this)}};this.getElement=function(){return f.element};this.buildNestedMetawidget=function(l,m){var o=metawidget.util.createElement(this,"metawidget");o.setAttribute("ng-model",metawidget.util.appendPath(l,this));if(metawidget.util.isTrueOrTrueString(l.readOnly)){o.setAttribute("read-only","true")}else{if(e.readOnly!==undefined){o.setAttribute("read-only",e.readOnly)}}var p="_metawidgetConfig"+c++;i.$parent[p]=f;if(m!==undefined){var n="_metawidgetConfig"+c++;i.$parent[n]=m;o.setAttribute("configs","["+p+","+n+"]")}else{o.setAttribute("config",p)
}return o}};metawidget.angular.inspectionresultprocessor=metawidget.angular.inspectionresultprocessor||{};metawidget.angular.inspectionresultprocessor.AngularInspectionResultProcessor=function(d){if(!(this instanceof metawidget.angular.inspectionresultprocessor.AngularInspectionResultProcessor)){throw new Error("Constructor called as a function")}this.processInspectionResult=function(g,j){function e(n,l){if(n!==l){for(var k=0,m=j._angularInspectionResultProcessor.length;k<m;k++){j._angularInspectionResultProcessor[k]()}j.invalidateInspection();j.buildWidgets()}}j._angularInspectionResultProcessor=j._angularInspectionResultProcessor||[];for(var f in g){var i=g[f];if(i instanceof Object){this.processInspectionResult(i,j);continue}if(i===undefined||i===null||i.slice===undefined){continue}if(i.length<4||i.slice(0,2)!=="{{"||i.slice(i.length-2,i.length)!=="}}"){continue}i=i.slice(2,i.length-2);g[f]=d.$eval(i)+"";var h=d.$watch(i,e);j._angularInspectionResultProcessor.push(h)}return g}};metawidget.angular.widgetprocessor=metawidget.angular.widgetprocessor||{};metawidget.angular.widgetprocessor.AngularWidgetProcessor=function(f,e){if(!(this instanceof metawidget.angular.widgetprocessor.AngularWidgetProcessor)){throw new Error("Constructor called as a function")}this.processWidget=function(k,p,j,o){var m=o.path;if(p!=="entity"){m=metawidget.util.appendPathWithName(m,j)}if(k.tagName==="OUTPUT"){if(!k.hasAttribute("ng-bind")){if(j.masked===true){e.$parent.mwMaskedOutput=d;k.setAttribute("ng-bind","mwMaskedOutput("+m+")")}else{if(j.type==="array"){k.setAttribute("ng-bind",m+".join(', ')")}else{if(j.enumTitles!==undefined){e.$parent.mwLookupEnumTitle=e.$parent.mwLookupEnumTitle||{};e.$parent.mwLookupEnumTitle[m]=function(q){return metawidget.util.lookupEnumTitle(q,j["enum"],j.enumTitles)};k.setAttribute("ng-bind",'mwLookupEnumTitle["'+m+'"]('+m+")")}else{if(j.type==="date"){k.setAttribute("ng-bind",m+"|date")}else{k.setAttribute("ng-bind",m)}}}}}}else{if(k.tagName==="INPUT"&&k.getAttribute("type")==="submit"){k.removeAttribute("ng-click")
}else{if(k.tagName==="INPUT"&&k.getAttribute("type")==="button"){k.setAttribute("ng-click",m+"()")}else{if(j["enum"]!==undefined&&(j.type==="array"||j.componentType!==undefined)&&k.tagName==="DIV"){for(var l=0,i=k.childNodes.length;l<i;l++){var n=k.childNodes[l];if(n.tagName==="LABEL"&&n.childNodes.length===2){var h=n.childNodes[0];if(h.tagName==="INPUT"){if(h.getAttribute("type")==="radio"){h.setAttribute("ng-model",m)}else{if(h.getAttribute("type")==="checkbox"){h.setAttribute("ng-checked",m+".indexOf('"+h.value+"')>=0");e.mwUpdateSelection=g;h.setAttribute("ng-click","mwUpdateSelection($event,'"+m+"')")}}}}}}else{if(k.tagName==="INPUT"||k.tagName==="SELECT"||k.tagName==="TEXTAREA"){k.setAttribute("ng-model",m)}}}}}if(j.required!==undefined){k.setAttribute("ng-required",j.required)}if(j.minLength!==undefined){k.setAttribute("ng-minlength",j.minLength)}if(j.maxLength!==undefined){k.setAttribute("ng-maxlength",j.maxLength);k.removeAttribute("maxlength")}return k};function g(h,l){var j=e.$eval(l);if(j===undefined){j=[];f(l).assign(e,j)}var k=h.target;var i=j.indexOf(k.value);if(k.checked===true){if(i===-1){j.push(k.value)}return}if(i!==-1){j.splice(i,1)}}function d(h){if(h===undefined){return}return metawidget.util.fillString("*",h.length)}}})();
